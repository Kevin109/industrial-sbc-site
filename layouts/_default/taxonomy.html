{{/* layouts/_default/taxonomy.html */}}

{{ define "title" -}}
  {{ .Title }} | {{ .Site.Title }}
{{- end }}

{{ define "main" }}
<article class="container">

  <!-- 顶部标题 + 简介（优先 tag/_index.md 里的 .Content 或 .Params.description） -->
  <header class="section-head-a">
    <h1 class="page-title-a">{{ .Title }}</h1>
    {{ $intro := "" }}
    {{ if .Content }}
      {{ $intro = .Content | plainify }}
    {{ else if .Params.description }}
      {{ $intro = .Params.description }}
    {{ else }}
      {{ $what := cond (eq .Data.Singular "tag") "tag" "category" }}
      {{ $intro = printf "Posts filed under the %s “%s”." $what .Title }}
    {{ end }}
    <p class="page-intro">{{ $intro }}</p>
  </header>

  <!-- 文章列表（分页） -->
  <section class="guides-section-a">
    {{ $p := .Paginate (.Pages.ByDate.Reverse) }}
    <div class="grid-guides-a">
      {{ range $p.Pages }}
      <article class="guide-card-a">
        <a class="card-anchor-a" href="{{ .RelPermalink }}" aria-label="{{ .Title }}"></a>

        {{ with .Params.cover }}
        <figure class="card-media-a">
          <img src="{{ . | relURL }}" alt="{{ $.Title }}">
        </figure>
        {{ end }}

        <header class="card-header-a">
          <h2 class="card-title-a"><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
          <div class="card-meta-a">
            <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2006-01-02" }}</time>
            {{ with .ReadingTime }}<span class="sep">·</span><span>{{ . }} min read</span>{{ end }}
          </div>
        </header>

        <div class="card-body-a">
          {{- $desc := default (.Summary | plainify) .Params.description -}}
          <p class="card-desc-a">{{ $desc | plainify | truncate 160 }}</p>
          {{ with .Params.tags }}
          <ul class="card-tags-a">
            {{ range . }}<li>#{{ . }}</li>{{ end }}
          </ul>
          {{ end }}
        </div>

        <footer class="card-footer-a">
          <span class="card-cta-a">Read →</span>
        </footer>
      </article>
      {{ end }}
    </div>

    {{ if gt $p.TotalPages 1 }}
    <nav class="pagination-a" aria-label="Pagination">
      {{ with $p.Prev }}
        <a class="page-btn-a" href="{{ .URL }}">← Newer</a>
      {{ else }}
        <span class="page-btn-a is-disabled-a">← Newer</span>
      {{ end }}

      <span class="page-count-a">Page {{ $p.PageNumber }} / {{ $p.TotalPages }}</span>

      {{ with $p.Next }}
        <a class="page-btn-a" href="{{ .URL }}">Older →</a>
      {{ else }}
        <span class="page-btn-a is-disabled-a">Older →</span>
      {{ end }}
    </nav>
    {{ end }}
  </section>

  {{ if eq .Data.Singular "tag" }}
  {{ partial "core-tiles.html" . }}
{{ end }}

</article>
{{ end }}